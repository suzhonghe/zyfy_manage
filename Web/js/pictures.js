$(function(){function t(t,n){var e=new Object;$.ajax({url:"../../queryBannerPhotos",type:"post",data:{type:n},async:!1,success:function(t){t&&(e=t)}}),$("#"+t+" tbody").html("");for(var a=0;a<e.length;a++){var i=null,s=null,o=null,l=null;s=e[a].pathAddress,o=e[a].title,l=e[a].jumpAddress,i=$("<tr><td class='img'><img src="+s+" /></td><td class='tdTitle'>"+o+"</td><td class='tdLink'><a href="+l+">"+l+"</a></td><td class='tdTime'></td><td class='control'><p><input class='upBtn' type='button' value='上移' onclick='upTr(this)'/><input class='downBtn' type='button' value='下移' onclick='downTr(this)'/></p><p><input class='editBtn' type='button' value='编辑' onclick='editTr(this)'/><input class='deleteBtn' type='button' value='删除' onclick='deleteTr(this)'/></p></td></tr>"),$("#"+t+" tbody").append(i)}}function n(t,n){$("#"+t).uploadify({auto:!0,swf:"../../uploadify.swf",uploader:"../../uploadBannerPhoto?type="+n,queueID:"fileQueue",formData:{recid:"${rec.id}"},multi:!0,fileTypeDesc:"请选择图片，仅支持格式JPG,BMP,PNG,GIF，最大4M",fileTypeExts:"*.JPG;*.GIF;*.PNG;*.BMP;",buttonText:"上传",width:60,height:30,fileObjName:"file",fileSizeLimit:"4MB",onUploadSuccess:function(n,e,a){1==a&&$("#"+t).parent().parent().find("img").attr("src",e)},onUploadError:function(t,n,e){alert(e),alert("上传失败","e")}})}function e(t,n){$("#"+t+" .release").click(function(){$(".reBox").show(),$(".signOut input").click(function(){$(".tabBanner ol").html(""),$(".tabBanner ul").html(""),$(".reBox").hide()});for(var e=[],a=[],i=0,s=$("#"+t+" table tbody tr").size();s>i;i++){var o={};o.jumpAddress=$("#"+t+" table tbody tr").eq(i).find(".tdLink").find("a").html(),o.pathAddress=$("#"+t+" table tbody tr").eq(i).find(".img").find("img").attr("src"),o.serialNumber=i,o.title=$("#"+t+" table tbody tr").eq(i).find(".tdTitle").html(),e.push(o),a.push($("#"+t+" table tbody tr").eq(i).find(".img").find("img").attr("src"))}var l=new Object;l.bannerPhotoVo=new Object,l.bannerPhotoVo.type=n,l.bannerPhotos=e,$.ajax({url:"../../saveBannerPhoto",type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(l),async:!1,success:function(t){if(1==t.code){for(var n=0,e=a.length;e>n;n++){var i=$("<li class='left'></li>"),s=$("<li></li>");0==n&&(i.addClass("act"),s.addClass("act")),s.css({backgroundImage:"url("+a[n]+")"}),i.appendTo($(".tabBanner ol")),s.appendTo($(".tabBanner ul"))}$(".tabBanner").tab()}else alert(t.message)}})}),$.fn.tab=function(){function t(){e.timer=setInterval(function(){e.iNow++,e.iNow==e.find("ol li").length&&(e.iNow=0),e.find("ul li").removeClass("act"),e.find("ol li").removeClass("act"),e.find("ul li").eq(e.iNow).addClass("act"),e.find("ol li").eq(e.iNow).addClass("act")},2e3)}function n(){clearInterval(e.timer),t()}var e=$(this);e.timer=null,e.iNow=0,$(this).find("ol li").click(function(){e.iNow=$(this).index(),$(this).parent().find("li").removeClass("act"),$(this).addClass("act"),$(this).parent().parent().find("ul li").removeClass("act"),$(this).parent().parent().find("ul li").eq($(this).index()).addClass("act")}),n(),$(this).mouseover(function(){clearInterval(e.timer)}),$(this).mouseout(function(){t()})}}$("#pcPhoto").show();var a=["pcPhoto","appPhoto","advPhoto","newsPhoto","articlePhoto"],i=["pc_banner","app_banner","advertisement","news","article"];$(".slideNav li").click(function(){$(".slideNav li").removeClass("act"),$(this).addClass("act"),$(".photoBox").hide(),$(".photoBox").eq($(this).index()).show(),t(a[$(this).index()],i[$(this).index()])}),t("pcPhoto","pc_banner"),$(".add").click(function(t){t.stopPropagation(),$(this).parents(".subBox").find(".addBox").toggle(),$(this).parents(".subBox").find(".addBox").find("img").attr("src",""),$(this).parents(".subBox").find(".addBox").find(".title").val(""),$(this).parents(".subBox").find(".addBox").find(".link").val("")}),n("pcUpBtn","pc_banner"),n("pcEditUpBtn","pc_banner"),n("appUpBtn","app_banner"),n("appEditUpBtn","app_banner"),n("advUpBtn","advertisement"),n("advEditUpBtn","advertisement"),n("newsUpBtn","news"),n("newsEditUpBtn","news"),n("articleUpBtn","article"),n("articleEditPicLink","article"),$(".addBox .determine").click(function(t){var n=null;n="pcPhoto"==$(this).parents(".photoBox").attr("id")?"pc_banner":"appPhoto"==$(this).parents(".photoBox").attr("id")?"app_banner":"advPhoto"==$(this).parents(".photoBox").attr("id")?"advertisement":"newsPhoto"==$(this).parents(".photoBox").attr("id")?"news":"article",t.stopPropagation(),$(this).parent().hide();var e=null,a=null,i=null,s=null;a=$(this).parent().find("img").attr("src"),i=$(this).parent().find(".title").val(),s=$(this).parent().find(".link").val(),a&&($.ajax({url:"../../modifyBannerPhoto",type:"post",data:{jumpAddress:s,pathAddress:a,title:i,type:n}}),e=$("<tr><td class='img'><img src="+a+" /></td><td class='tdTitle'>"+i+"</td><td class='tdLink'><a href='+imgLink+'>"+s+"</a></td><td class='tdTime'></td><td class='control'><p><input class='upBtn' type='button' value='上移' onclick='upTr(this)'/><input class='downBtn' type='button' value='下移' onclick='downTr(this)'/></p><p><input class='editBtn' type='button' value='编辑' onclick='editTr(this)'/><input class='deleteBtn' type='button' value='删除' onclick='deleteTr(this)'/></p></td></tr>"),$(this).parent().parent().find("tbody").prepend(e))}),e("pcPhoto","pc_banner"),e("appPhoto","app_banner"),e("advPhoto","advertisement"),e("newsPhoto","news")});